# Web

## 事件捕获、冒泡

## 性能优化

## Html 语义化

Html 语义化是使用一些语义化的标签来定义 html 的结构。语义化有以下好处：

- 使 html 文档 结构更加清晰
- 便于 SEO 搜索引擎识别文档内容，便于爬虫爬取网页内容以获取网页内容
- 便于一些盲人阅读器得到网页结构信息以便于对网页内容换方式重现

## cookie vs localStorage vs sessionStorage

<table>
  <thead>
    <tr>
      <th>特性</th>
      <th>cookie</th>
      <th>localStorage</th>
      <th>sessionStorage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>数据的生命周期</td>
      <td>一般由服务器生成，可设置失效时间。如果在浏览器端生成Cookie，默认是关闭浏览器后失效</td>
      <td>除非被清除，否则永久保存</td>
      <td>仅在当前会话下有效，关闭页面或浏览器后被清除</td>
    </tr>
    <tr>
      <td>存放数据大小</td>
      <td>4K左右</td>
      <td colspan="2">一般为5MB</td>
    </tr>
    <tr>
      <td>与服务器端通信</td>
      <td>每次都会携带在HTTP头中，如果使用cookie保存过多数据会带来性能问题</td>
      <td colspan="2">仅在客户端（即浏览器）中保存，不参与和服务器的通信</td>
    </tr>
    <tr>
      <td>易用性</td>
      <td>需要程序员自己封装，cookie 接口不友好</td>
      <td colspan="2">原生接口可以接受，亦可再次封装来对 Object 和 Array 有更好的支持</td>
    </tr>
  </tbody>
</table>

## 同源策略及 CORS

同源策略是指三个相同：

- 协议相同
- 域名相同
- 端口相同

同源政策的目的，是为了保证用户信息的安全，防止恶意的网站窃取数据。

如果非同源，共有三种行为受到限制。

- Cookie、LocalStorage 和 IndexDB 无法读取
- DOM 无法获得
- AJAX 请求不能发送

CORS 是跨源资源分享（Cross-Origin Resource Sharing）的缩写。它是 W3C 标准，它允许浏览器向跨源服务器，发出 XMLHttpRequest 请求，从而克服了 AJAX 只能同源使用的限制。相比 JSONP 只能发 GET 请求，CORS 允许任何类型的请求。

## 浏览器的工作原理

浏览器的主要组件为：

- 用户界面 包括地址栏、前进/后退按钮、书签菜单等。除了浏览器主窗口显示的您请求的页面外，其他显示的各个部分都属于用户界面。
- 浏览器引擎 在用户界面和渲染引擎之间传送指令。
- 渲染引擎 负责显示请求的内容。如果请求的内容是 HTML，它就负责解析 HTML 和 CSS 内容，并将解析后的内容显示在屏幕上。
- 网络 用于网络调用，比如 HTTP 请求。其接口与平台无关，并为所有平台提供底层实现。
- 用户界面后端 用于绘制基本的窗口小部件，比如组合框和窗口。其公开了与平台无关的通用接口，而在底层使用操作系统的用户界面方法。
JavaScript 解释器。用于解析和执行 JavaScript 代码。
- 数据存储。这是持久层。浏览器需要在硬盘上保存各种数据，例如 Cookie。新的 HTML 规范 (HTML5) 定义了“网络数据库”，这是一个完整（但是轻便）的浏览器内数据库。

浏览器渲染页面的过程主要有：

- DNS 查询
- TCP 连接
- HTTP 请求及响应
- 服务器响应
- 客户端渲染

### 渲染引擎

Firefox 使用的是 Gecko，而 Safari 和 Chrome 浏览器使用的都是 WebKit。

WebKit 的主流程如下：

![webkitflow](./webkitflow.png)

简要来说，可以分为以下几个步骤：

- 处理 HTML 标记并构建 DOM 树
- 处理 CSS 标记并构建 CSSOM 树
- 将 DOM 与 CSSOM 合并成一个渲染树
- 根据渲染树来布局，以计算每个节点的几何信息
- 将各个节点绘制到屏幕上

### 关键渲染路径

关键渲染路径（Critical Rendering Path）是指与当前用户操作有关的内容。

- CSS 是阻塞渲染的资源。需要将它尽早、尽快地下载到客户端，以便缩短首次渲染的时间。
- 浏览器将延迟脚本执行和 DOM 构建，直至其完成 CSSOM 的下载和构建。

为尽快完成首次渲染，我们需要最大限度减小以下三种可变因素：`关键资源的数量`、`关键路径长度` 和 `关键字节的数量`。优化关键渲染路径的常规步骤如下：

- 对关键路径进行分析和特性描述：资源数、字节数、长度
- 最大限度减少关键资源的数量：删除它们，延迟它们的下载，将它们标记为异步等
- 优化关键字节数以缩短下载时间（往返次数）
- 优化其余关键资源的加载顺序：您需要尽早下载所有关键资产，以缩短关键路径长度

PageSpeed 规则和建议：

- 消除阻塞渲染的 JavaScript 和 CSS
- 优化 JavaScript 的使用

  - 首选使用异步 JavaScript 资源
  - 避免同步服务器调用
  - 延迟解析 JavaScript
  - 避免运行时间长的 JavaScript

- 优化 CSS 的使用

  - 将 CSS 置于文档 head 标签内
  - 避免使用 CSS import，因为会在关键路径中增加往返次数
  - 内联阻塞渲染的 CSS，可实现“一次往返”关键路径长度
